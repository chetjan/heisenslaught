let allHeroes = {
    "Abathur": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/34/abathur.jpg",
    "Alarak": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/8477/alarak.jpg",
    "Anub'arak": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/35/anubarak.jpg",
    "Artanis": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/36/artanis.jpg",
    "Arthas": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/37/arthas.jpg",
    "Auriel": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/7328/auriel.jpg",
    "Azmodan": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/38/azmodan.jpg",
    "Brightwing": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/39/brightwing.jpg",
    "Chen": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/40/chen.jpg",
    "Cho": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/41/chogall.jpg",
    "Chromie": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/6403/chromie.jpg",
    "Dehaka": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/3838/dehaka.jpg",
    "Diablo": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/42/diablo.jpg",
    "E.T.C": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/43/etc.jpg",
    "Falstad": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/44/falstad.jpg",
    "Gall": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/45/chogall.jpg",
    "Gazlowe": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/46/gazlowe.jpg",
    "Greymane": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/861/greymane.jpg",
    "Gul'dan": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/6779/guldan.jpg",
    "Illidan": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/47/illidan.jpg",
    "Jaina": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/48/jaina.jpg",
    "Johanna": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/49/johanna.jpg",
    "Kael'thas": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/50/kaelthas.jpg",
    "Kerrigan": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/51/kerrigan.jpg",
    "Kharazim": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/52/kharazim.jpg",
    "Leoric": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/53/leoric.jpg",
    "Li Li": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/54/lili.jpg",
    "Li-Ming": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/2022/li-ming.jpg",
    "Lt. Morales": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/55/lt-morales.jpg",
    "Lunara": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/92/lunara.jpg",
    "Malfurion": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/56/malfurion.jpg",
    "Medivh": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/6404/medivh.jpg",
    "Muradin": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/57/muradin.jpg",
    "Murky": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/58/murky.jpg",
    "Nazeebo": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/59/nazeebo.jpg",
    "Nova": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/60/nova.jpg",
    "Raynor": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/61/raynor.jpg",
    "Rehgar": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/62/rehgar.jpg",
    "Misha": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/63/rexxar.jpg",
    "Samuro": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/8666/samuro.jpg",
    "Sgt. Hammer": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/64/sgt-hammer.jpg",
    "Sonya": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/65/sonya.jpg",
    "Stitches": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/66/stitches.jpg",
    "Sylvanas": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/67/sylvanas.jpg",
    "Tassadar": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/68/tassadar.jpg",
    "The Butcher": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/69/the-butcher.jpg",
    "Do Not Touch (TLV)": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/70/the-lost-vikings.jpg",
    "Thrall": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/71/thrall.jpg",
    "Tracer": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/4836/tracer.jpg",
    "Tychus": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/72/tychus.jpg",
    "Tyreal": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/73/tyrael.jpg",
    "Tyrande": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/74/tyrande.jpg",
    "Uther": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/75/uther.jpg",
    "Valla": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/76/valla.jpg",
    "Varian": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/8876/varian.jpg",
    "Xul": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/3166/xul.jpg",
    "Zagara": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/77/zagara.jpg",
    "Zarya": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/8478/zarya.jpg",
    "Zeratul": "https://chairleague.s3.amazonaws.com/uploads/avatar/attachment/78/zeratul.jpg"
};

$(document).ready(function () {
    let queryParam = function getUrlVars() {
        var vars = [], hash;
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for (var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
        }
        return vars;
    } ();
    let userName = queryParam.type;
    let draftTeam;
    if (userName === "obs")
    {
        userName = prompt("Enter your name: ");
    } else if (userName === "Team0") {
        draftTeam = 0;
    } else if (userName === "Team1") {
        draftTeam = 1;
    }
    let chat = $.connection.draftHub;
    chat.client.messageReceived = function (originatorUser, message) {
        $("#draft").append('<li><strong>' + originatorUser + '</strong>: ' + message);
    };

    chat.client.getConnectedUsers = function (userList) {
        for (let i = 0; i < userList.length; i++) {
            addUser(userList[i]);
        }
    };

    chat.client.newUserAdded = function (newUser) {
        addUser(newUser);
    };

    chat.client.updateDraftState = function (draftState) {
        $("#draftPhase").text(draftState.CurrentPhase);
        $("#team0Timer").text("Team 0: " + draftState.TimeTeam0);
        $("#team1Timer").text("Team 1: " + draftState.TimeTeam1);
        $("#bansTeam0").text(JSON.stringify(draftState.BansTeam0));
        $("#bansTeam1").text(JSON.stringify(draftState.BansTeam1));
        $("#picksTeam0").text(JSON.stringify(draftState.PicksTeam0));
        $("#picksTeam1").text(JSON.stringify(draftState.PicksTeam1));
    };

    $.connection.hub.logging = true;
    $.connection.hub.start().done(function () {
        chat.server.connect(userName);
    });

    $("#heroPick").focus();

    $("#selectHero").click(function () {
        if (draftTeam !== undefined) {
            chat.server.pick(draftTeam, $("#heroPick").val());
        } else {
            chat.server.send(userName, $("#heroPick").val());
        }
        $("#heroPick").val("");
        $("#heroPick").focus();
    });

    $("#heroPick").keyup(function (event) {
        if (event.keyCode === 13)
            $("#selectHero").click();
    });

    function addUser(user) {
        $("#userList").append('<li>' + user + '</li>');
    }

    Object.keys(allHeroes).forEach(function (hero) {
        let heroId = hero.replace(/[^a-zA-Z]/gi, '');
        $("#allHeroes").append('<li style="width:150px; height:100px; float:left;" id="allHeroes' + heroId + '">' + "<img src='" + allHeroes[hero] + "'height='50' width='25'>" + hero + "</li>");
        if (draftTeam !== undefined) {
            $("#allHeroes" + heroId).click(function () {
                chat.server.pick(draftTeam, hero); 
            });
        }
    });
});
